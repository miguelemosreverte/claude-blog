<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Eastern Front 1941–1945 — Interactive Map</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0f; overflow: hidden; height: 100vh;
    display: flex; align-items: center; justify-content: center;
    user-select: none;
  }
  #frame {
    max-width: 100%; max-height: 100vh; object-fit: contain;
    display: block;
  }
  /* Subtle nav arrows, visible on hover */
  .nav {
    position: fixed; top: 0; width: 80px; height: 100%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; opacity: 0; transition: opacity 0.3s;
    z-index: 10;
  }
  .nav:hover { opacity: 1; }
  .nav svg { width: 28px; height: 28px; fill: rgba(212,168,83,0.6); }
  #prev { left: 0; }
  #next { right: 0; }
</style>
</head>
<body>

<div id="prev" class="nav" onclick="go(-1)">
  <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
</div>

<img id="frame" alt="Eastern Front Map">

<div id="next" class="nav" onclick="go(1)">
  <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
</div>

<script>
const FRAME_BASE = '../map-frames';
let dates = [];
let idx = 0;
let imgs = {};

let loopTimer = null;

async function init() {
  const res = await fetch('../map-data/dates.json');
  dates = await res.json();
  // Preload all frames
  await Promise.all(dates.map(d => new Promise(resolve => {
    const i = new Image();
    i.onload = resolve;
    i.onerror = resolve;
    i.src = `${FRAME_BASE}/${d.date}.png`;
    imgs[d.date] = i;
  })));
  show(0);
  startLoop();
}

function show(i) {
  idx = ((i % dates.length) + dates.length) % dates.length;
  document.getElementById('frame').src = `${FRAME_BASE}/${dates[idx].date}.png`;
}

function go(delta) { show(idx + delta); }

function startLoop() {
  if (loopTimer) return;
  const interval = Math.round(10000 / dates.length);
  loopTimer = setInterval(() => show(idx + 1), interval);
}

function stopLoop() {
  clearInterval(loopTimer);
  loopTimer = null;
}

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowRight' || e.key === 'ArrowUp') { e.preventDefault(); stopLoop(); go(1); }
  if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') { e.preventDefault(); stopLoop(); go(-1); }
});

// Stop auto-loop on manual interaction, restart after 3s idle
document.querySelectorAll('.nav').forEach(el => {
  el.addEventListener('click', () => { stopLoop(); setTimeout(startLoop, 3000); });
});

init();
</script>
</body>
</html>
