import{r as S,j as s}from"./index-Cpi14mRT.js";import X from"./eastern-front-EtqqQfSf.js";import{L as wt}from"./land-mask-Bt4oIyE1.js";const l={bg:"#08090c",mapBg:"#0d1117",text:"#c8cad0",titleColor:"#888",subtitleColor:"#555",periodLabel:"#e0dcd4",periodSub:"#8a8580",tileFilter:"brightness(0.95) saturate(0.4) contrast(1.1)",territory:{axisLabel:"rgba(170,175,185,0.2)",sovietLabel:"rgba(210,60,60,0.18)"},frontLine:{glow:[[14,"rgba(255,200,40,0.12)"],[5,"rgba(255,200,40,0.28)"],[2,"rgba(255,220,60,0.9)"]]},city:{axis:{dot:"rgba(140,155,175,0.85)",label:"rgba(140,155,175,0.7)"},soviet:{dot:"rgba(210,170,170,0.85)",label:"rgba(200,180,180,0.65)"},majorDot:"rgba(255,255,255,0.9)",majorLabel:"rgba(255,255,255,0.92)",majorRing:"rgba(255,255,255,0.6)",majorGlow:"rgba(255,255,255,0.06)",shadow:"rgba(0,0,0,0.7)"},timeline:{active:"#c4913a",inactive:"#444",bg:"#1a1a1a",track:"#222",gradient:["#6b4a2a","#c4913a"],glow:"rgba(196,145,58,0.4)"},legend:{axis:{label:"Axis-controlled",bg:"rgba(50,55,65,0.7)",border:"#444"},soviet:{label:"Soviet-controlled",bg:"rgba(160,25,25,0.5)",border:"#663030"},frontLine:{label:"Front line",bg:"rgba(255,220,60,0.85)"}},attribution:"#333"},O=X.scenario,W=X.map,st=X.cities.map(([i,e,r,o,u,d])=>({id:i,name:e,lat:r,lon:o,major:u,startControl:d})),Mt=X.events.map(([i,e,r,o])=>({date:i,cityId:e,control:r,labels:o||{}})),_=X.labels.map(([i,e,r])=>({date:i,label:e,sub:r})),ct=W.zoom,j=W.tileSize,[K,pt]=W.tileXRange,[N,xt]=W.tileYRange,M=(pt-K+1)*j,D=(xt-N+1)*j;function Lt(){const i=[];for(let e=N;e<=xt;e++)for(let r=K;r<=pt;r++)i.push({key:`${r}_${e}`,url:W.tileUrlTemplate.replace("{z}",ct).replace("{x}",r).replace("{y}",e),x:(r-K)*j,y:(e-N)*j});return i}const Tt=Lt();function x(i,e){const r=1<<ct,o=(e+180)/360*r*j-K*j,u=i*Math.PI/180,d=(1-Math.log(Math.tan(u)+1/Math.cos(u))/Math.PI)/2*r*j-N*j;return[o,d]}function $(i,e,r){return i+(e-i)*r}function Et(i){const e=1<<ct,r=i+N*j,o=Math.PI*(1-2*r/(e*j));return Math.atan(Math.sinh(o))*180/Math.PI}const _t=wt.conflict.map(i=>i.map(e=>e.map(([r,o])=>x(o,r))));function At(i){i.beginPath();for(const e of _t)for(const r of e)if(!(r.length<3)){i.moveTo(r[0][0],r[0][1]);for(let o=1;o<r.length;o++)i.lineTo(r[o][0],r[o][1]);i.closePath()}i.clip()}function kt(i){const e={},r={};for(const o of st)e[o.id]=o.startControl,r[o.id]={};for(const o of Mt){if(o.date>i)break;e[o.cityId]=o.control,o.labels&&Object.assign(r[o.cityId],o.labels)}return{ctrl:e,labels:r}}function Ft(i,e,r,o){let u=0;for(const d of st){const y=r[d.id];if(!y||y==="neutral")continue;const p=i-d.lat,B=e-d.lon,k=p*p+B*B;if(k>64)continue;const tt=y==="axis"?1:-1,L=o[d.id]||{};let G=L.strength!=null?L.strength:d.major?1.5:1;for(const[et,T]of Object.entries(L))et==="strength"||typeof T!="number"||T>=0&&T<=1&&(G*=1-T);const F=1+k;u+=tt*G/(F*F*F)}return u}const P=.2,yt=62,vt=43,A=10,jt=52,I=Math.ceil((yt-vt)/P),g=Math.ceil((jt-A)/P),J=document.createElement("canvas");J.width=g;J.height=I;const bt=J.getContext("2d"),[mt]=x(50,A),[Rt]=x(50,jt),[,Q]=x(yt,30),[,It]=x(vt,30),V=new Float64Array(I);for(let i=0;i<I;i++){const e=Q+(i+.5)*(It-Q)/I;V[i]=Et(e)}function Dt(i,e){const r=new Float32Array(I*g);for(let o=0;o<I;o++){const u=V[o];for(let d=0;d<g;d++){const y=A+(d+.5)*P;r[o*g+d]=Ft(u,y,i,e)}}return r}const Ct=[null,[[3,2]],[[2,1]],[[3,1]],[[0,1]],[[3,0],[2,1]],[[0,2]],[[3,0]],[[3,0]],[[0,2]],[[0,1],[3,2]],[[0,1]],[[3,1]],[[2,1]],[[3,2]],null],C=_.map(i=>{const{ctrl:e,labels:r}=kt(i.date),o=Dt(e,r);return{...i,control:e,fieldGrid:o}});function Pt(i){const e=Math.min(Math.floor(i),C.length-2),r=i-e,o=C[e],u=C[Math.min(e+1,C.length-1)],d=I*g,y=new Float32Array(d);for(let p=0;p<d;p++)y[p]=o.fieldGrid[p]+(u.fieldGrid[p]-o.fieldGrid[p])*r;return{control:o.control,label:o.label,sub:o.sub,fieldGrid:y}}function $t(){const i=S.useRef(null),[e,r]=S.useState(0),o=S.useRef(null),[u,d]=S.useState(null),y=S.useRef(0),[p,B]=S.useState({w:800,h:600}),k=S.useRef(null);S.useEffect(()=>{const a=new ResizeObserver(h=>{for(const t of h)B({w:t.contentRect.width,h:t.contentRect.height})});return k.current&&a.observe(k.current),()=>a.disconnect()},[]),S.useEffect(()=>{if(u===null)return;const a=y.current,h=u,t=Math.abs(h-a)*400+200,H=performance.now();function v(Y){const m=Math.min((Y-H)/t,1),w=m<.5?2*m*m:1-Math.pow(-2*m+2,2)/2,z=$(a,h,w);y.current=z,r(z),m<1?o.current=requestAnimationFrame(v):d(null)}return o.current=requestAnimationFrame(v),()=>cancelAnimationFrame(o.current)},[u]);const tt=p.h-160,L=Math.min(p.w/M,tt/D,1),G=M*L,F=D*L;S.useEffect(()=>{const a=i.current;if(!a)return;const h=window.devicePixelRatio||1;a.width=M*h,a.height=D*h;const t=a.getContext("2d");t.setTransform(h,0,0,h,0,0),t.clearRect(0,0,M,D);const H=Pt(e);t.save(),At(t);const v=H.fieldGrid,Y=bt.createImageData(g,I),m=Y.data;for(let n=0;n<I;n++)for(let c=0;c<g;c++){const f=v[n*g+c];if(f===0)continue;const b=(n*g+c)*4;f>0?(m[b]=50,m[b+1]=55,m[b+2]=65,m[b+3]=Math.min(166,f*89|0)):(m[b]=160,m[b+1]=25,m[b+2]=25,m[b+3]=Math.min(140,-f*64|0))}bt.putImageData(Y,0,0),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.drawImage(J,mt,Q,Rt-mt,It-Q);const w=[],z=P;for(let n=0;n<I-1;n++)for(let c=0;c<g-1;c++){const f=v[n*g+c],b=v[n*g+c+1],E=v[(n+1)*g+c],R=v[(n+1)*g+c+1],St=(f>0?8:0)|(b>0?4:0)|(R>0?2:0)|(E>0?1:0),gt=Ct[St];if(!gt)continue;const it=V[n],rt=V[n+1],lt=A+(c+.5)*z,at=A+(c+1.5)*z,Z=[x(it,$(lt,at,f/(f-b||1))),x($(it,rt,b/(b-R||1)),at),x(rt,$(lt,at,E/(E-R||1))),x($(it,rt,f/(f-E||1)),lt)];for(const[ht,ut]of gt)w.push(Z[ht][0],Z[ht][1],Z[ut][0],Z[ut][1])}t.save(),t.lineCap="round";function dt(){t.beginPath();for(let n=0;n<w.length;n+=4)t.moveTo(w[n],w[n+1]),t.lineTo(w[n+2],w[n+3]);t.stroke()}for(const[n,c]of l.frontLine.glow)t.strokeStyle=c,t.lineWidth=n,dt();t.strokeStyle="rgba(255,220,60,0.9)",t.lineWidth=1.5,dt(),t.restore(),t.restore();for(const n of st){const[c,f]=x(n.lat,n.lon);if(c<-20||c>M+20||f<-20||f>D+20)continue;const b=H.control[n.id]||"soviet",E=l.city[b]||l.city.soviet;n.major&&(t.beginPath(),t.arc(c,f,10,0,Math.PI*2),t.fillStyle=l.city.majorGlow,t.fill()),n.major&&(t.beginPath(),t.arc(c,f,5,0,Math.PI*2),t.strokeStyle=l.city.majorRing,t.lineWidth=1.5,t.stroke()),t.beginPath(),t.arc(c,f,n.major?3:2,0,Math.PI*2),t.fillStyle=n.major?l.city.majorDot:E.dot,t.fill(),t.save(),t.font=n.major?"bold 13px Georgia, serif":"10px Georgia, serif",t.textAlign="left",t.textBaseline="middle";const R=n.major?12:7;t.fillStyle=l.city.shadow,t.fillText(n.name,c+R+1,f+1),t.fillStyle=n.major?l.city.majorLabel:E.label,t.fillText(n.name,c+R,f),t.restore()}t.save();const q=Math.floor(I/2);let U=25;for(let n=g-1;n>=0;n--)if(v[q*g+n]>0){const c=n<g-1?v[q*g+n+1]:0;if(c<0){const f=v[q*g+n]/(v[q*g+n]-c);U=A+(n+.5+f)*P}else U=A+(n+.5)*P;break}const ft=x(52,0)[1],[nt]=x(52,U-8),[ot]=x(52,U+8);t.textAlign="center",t.textBaseline="middle",nt>30&&nt<M-30&&(t.font="bold 20px Georgia, serif",t.fillStyle=l.territory.axisLabel,t.fillText(O.attackerName,nt,ft)),ot>30&&ot<M-30&&(t.font="bold 16px Georgia, serif",t.fillStyle=l.territory.sovietLabel,t.fillText(O.defenderName,ot,ft)),t.restore()},[e,p]);const et=Math.round(e),T=C[Math.min(et,C.length-1)];return s.jsxs("div",{ref:k,style:{width:"100%",height:"100vh",background:l.bg,display:"flex",flexDirection:"column",alignItems:"center",fontFamily:"Georgia, 'Times New Roman', serif",color:l.text,overflow:"hidden",position:"relative"},children:[s.jsxs("div",{style:{width:"100%",padding:"12px 20px 6px",textAlign:"center",zIndex:3,background:`linear-gradient(to bottom, ${l.bg} 60%, transparent)`},children:[s.jsx("h1",{style:{margin:0,fontSize:16,fontWeight:400,letterSpacing:6,textTransform:"uppercase",color:l.titleColor},children:O.title}),s.jsx("div",{style:{fontSize:11,color:l.subtitleColor,marginTop:2,letterSpacing:3},children:O.subtitle})]}),s.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",width:"100%",minHeight:0},children:s.jsxs("div",{style:{position:"relative",width:G,height:F,overflow:"hidden",borderRadius:2,background:l.mapBg},children:[s.jsx("div",{style:{position:"absolute",top:0,left:0,width:M,height:D,transform:`scale(${L})`,transformOrigin:"top left",filter:l.tileFilter},children:Tt.map(a=>s.jsx("img",{src:a.url,alt:"",draggable:!1,style:{position:"absolute",left:a.x,top:a.y,width:j,height:j,display:"block"}},a.key))}),s.jsx("canvas",{ref:i,style:{position:"absolute",top:0,left:0,width:G,height:F,pointerEvents:"none"}})]})}),s.jsxs("div",{style:{width:"100%",maxWidth:900,padding:"10px 24px 18px",zIndex:2},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:10},children:[s.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:l.periodLabel,transition:"all 0.3s"},children:T.label}),s.jsx("div",{style:{fontSize:12,color:l.periodSub,fontStyle:"italic",marginTop:2},children:T.sub})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"relative",marginBottom:8,padding:"0 6px"},children:[s.jsx("div",{style:{position:"absolute",left:6,right:6,top:"50%",height:2,background:l.timeline.track,transform:"translateY(-50%)",zIndex:0}}),s.jsx("div",{style:{position:"absolute",left:6,top:"50%",height:2,background:`linear-gradient(90deg, ${l.timeline.gradient[0]}, ${l.timeline.gradient[1]})`,transform:"translateY(-50%)",zIndex:1,width:`${e/(_.length-1)*100}%`}}),_.map((a,h)=>{const t=Math.abs(e-h)<.3;return s.jsx("button",{onClick:()=>d(h),style:{position:"relative",zIndex:2,width:t?14:10,height:t?14:10,borderRadius:"50%",border:`2px solid ${t?l.timeline.active:l.timeline.inactive}`,background:t?l.timeline.active:l.timeline.bg,cursor:"pointer",transition:"all 0.3s",padding:0,boxShadow:t?`0 0 10px ${l.timeline.glow}`:"none"},title:a.label},a.date)})]}),s.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:_.map((a,h)=>s.jsx("div",{onClick:()=>d(h),style:{fontSize:8,textAlign:"center",flex:1,cursor:"pointer",color:Math.abs(e-h)<.3?l.timeline.active:l.timeline.inactive,transition:"color 0.3s",letterSpacing:.3,lineHeight:1.2,whiteSpace:"nowrap",overflow:"hidden"},children:a.label},a.date))}),s.jsx("div",{style:{padding:"8px 4px 0"},children:s.jsx("input",{type:"range",min:0,max:_.length-1,step:.01,value:e,onChange:a=>{d(null);const h=parseFloat(a.target.value);y.current=h,r(h)},style:{width:"100%",height:4,appearance:"none",WebkitAppearance:"none",background:`linear-gradient(90deg, ${l.timeline.gradient[0]} 0%, ${l.timeline.gradient[1]} ${e/(_.length-1)*100}%, ${l.timeline.track} ${e/(_.length-1)*100}%, ${l.timeline.track} 100%)`,borderRadius:2,outline:"none",cursor:"pointer"}})}),s.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:20,marginTop:10,fontSize:10,color:"#666",flexWrap:"wrap"},children:[[l.legend.axis,l.legend.soviet].map(a=>s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx("div",{style:{width:14,height:10,background:a.bg,border:`1px solid ${a.border}`,borderRadius:2}}),a.label]},a.label)),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx("div",{style:{width:14,height:2,background:l.legend.frontLine.bg,borderRadius:1}}),l.legend.frontLine.label]})]})]}),s.jsx("div",{style:{position:"absolute",bottom:2,right:8,fontSize:8,color:l.attribution},children:O.attribution})]})}export{$t as default};
